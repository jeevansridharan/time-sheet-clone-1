<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>tpodo — Login</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; padding: 24px; }
      .card { max-width:480px; margin:24px auto; padding:18px; border:1px solid #ddd; border-radius:8px }
      .hint { font-size:0.9rem; color:#666 }
      label { display:block; margin-top:12px }
      input { width:100%; padding:8px; margin-top:6px; box-sizing:border-box }
      button { margin-top:12px; padding:10px 14px }
      pre { background:#f7f7f7; padding:10px; overflow:auto }
    </style>
  </head>
  <body>
    <h1>Time Sheet  — Login ⌚</h1>

    <div class="card">
      <h2>Sign in to Time Sheet</h2>
  <p class="hint">Enter your email and password to sign in. Tokens are stored in localStorage for this demo.</p>
  <p class="hint">Don't have an account? <a href="/register">Register here</a>.</p>

      <form id="loginForm">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required placeholder="you@company.com" />

        <label for="password">Password</label>
        <input id="password" name="password" type="password" required placeholder="••••••••" />

        <label style="display:block; margin-top:10px"><input id="remember" type="checkbox" /> Remember token</label>

        <button type="submit">Login</button>
      </form>

      <div id="result" style="margin-top:12px"></div>

  <!-- manual curl example removed -->
    </div>

    <script>
      // Simple client-side login handler. Stores token in localStorage or sessionStorage based on "Remember".
      const form = document.getElementById('loginForm');
      const out = document.getElementById('result');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        out.textContent = 'Signing in...';
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const remember = document.getElementById('remember').checked;
        try {
          const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          if (!res.ok) {
            const err = await res.json().catch(()=>({ error: 'Unexpected response' }));
            out.innerHTML = '<strong style="color:red">Error:</strong> ' + (err.error || JSON.stringify(err));
            return;
          }
          const data = await res.json();
          const token = data.token;
          if (!token) {
            out.innerHTML = '<strong style="color:orange">Warning:</strong> No token returned.';
            return;
          }
          if (remember) localStorage.setItem('tpodo_token', token); else sessionStorage.setItem('tpodo_token', token);
          out.innerHTML = '<strong style="color:green">Success</strong> — token stored. You can now use the API.';
          // Optionally redirect to a dashboard route if you add one later
          // window.location.href = '/dashboard.html';
        } catch (err) {
          out.innerHTML = '<strong style="color:red">Error:</strong> ' + err.message;
        }
      });
    </script>
  </body>
</html>
